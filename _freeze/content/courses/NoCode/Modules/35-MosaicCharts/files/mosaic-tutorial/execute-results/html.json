{
  "hash": "4f148465345dba5c74d8aee6a50318a5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Mosaic Chart Step by Step Tutorial\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"vcd\")\nlibrary(\"scatterplot3d\")\nlibrary(colorspace)\n## random seed\nmyseed <- 1071\nset.seed(myseed)\n```\n:::\n\n\n## Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"Hospital\")\ndata(\"Arthritis\")\nart <- xtabs(~ Treatment + Improved, data = Arthritis, subset = Sex == \"Female\")\nnames(dimnames(art))[2] <- \"Improvement\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"UCBAdmissions\")\nnames(dimnames(UCBAdmissions)) <- c(\"Admission\", \"Gender\", \"Department\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"Punishment\")\npunish <- xtabs(Freq ~ memory + attitude + age + education, data = Punishment)\ndimnames(punish)[[3]][3] <- \"40+\"\n```\n:::\n\n\n\n## Inference\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(myseed)\nart_max <- coindep_test(art, n = 5000)\n\nset.seed(myseed)\nucb_max <- coindep_test(aperm(UCBAdmissions, c(3,2,1)), margin = \"Department\", n = 5000)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(myseed)\nart_chisq <- coindep_test(art, n = 5000, indepfun = function(x) sum(x^2))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(myseed)\nhos_chisq <- coindep_test(Hospital, n = 5000, indepfun = function(x) sum(x^2))\n```\n:::\n\n\n\n## Figures\n########################################################\n### Figure 12.1: Grouped bar chart for the hospital data\n########################################################\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbarplot(Hospital, legend = rownames(Hospital), beside = TRUE,\n        xlab = \"Length of stay\", ylab = \"Number of patients\")\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Hopsital-plots-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n###################################################\n### Figure 12.2: 3D bar chart for the hospital data\n###################################################\nmyHospital = t(Hospital)[,3:1]\nmydat = data.frame(\"Length of stay\" = as.vector(row(myHospital)),\n                   \"Visit frequency\" = as.vector(col(myHospital)),\n                   \"Number of patients\" = as.vector(myHospital))\nscatterplot3d(mydat, type = \"h\", pch = \" \", lwd = 10,\nx.ticklabs = c(\"2-9\",\"\",\"10-19\",\"\",\"20+\"),\n              y.ticklabs = c(\"Never\",\"\",\"Less than monthly\",\"\",\"Regular\"),\n              xlab = \"Length of stay\", ylab = \"Visit frequency\", zlab = \"Number of patients\",\n              y.margin.add = 0.2,\n              color = \"black\", box = FALSE)\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Hopsital-plots-2.png){width=2100}\n:::\n\n```{.r .cell-code}\n############################################################################\n### Figure 12.3: Construction of a mosaic plot for the hospital data, step 1\n############################################################################\nmosaic(margin.table(Hospital, 2), split = TRUE)\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Hopsital-plots-3.png){width=2100}\n:::\n:::\n\n\n\n### Figure 12.4: Construction of a mosaic plot for the hospital data, step 2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmosaic(t(Hospital), split = TRUE, mar = c(left = 3.5),\n       labeling_args = list(offset_labels = c(left = 0.5),\n         offset_varnames = c(left = 1, top = 0.5), set_labels =\n         list(\"Visit frequency\" = c(\"Regular\",\"Less than\\nmonthly\",\"Never\"))))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/unnamed-chunk-9-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n###\n### Figure 12.5: Mosaic plot for the Hospital data, alternative splitting\n\nmosaic(Hospital)\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/unnamed-chunk-9-2.png){width=2100}\n:::\n:::\n\n\n\n### Figure 12.6: Sieve plot for the hospital data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsieve(t(Hospital), split = TRUE, pop = FALSE, gp = gpar(lty = \"dotted\", col = \"black\"))\nlabeling_cells(text = t(Hospital), clip = FALSE, gp = gpar(fontface = 2, fontsize = 15))(t(Hospital))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Hopsital-Sieve-Plot-1.png){width=2100}\n:::\n:::\n\n\n\n\n### Figure 12.7: Association plot for the hospital data\n\n::: {.cell}\n\n```{.r .cell-code}\nassoc(t(Hospital), split = TRUE)\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Hospital-Association-Plot-1.png){width=2100}\n:::\n:::\n\n\n\n\n### Figure 12.8: Qualitative color palette for HSV and HCL space\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(1,2), mar = c(1,1,1,1), oma = c(0,0,0,0))\npie(rep(1,9), radius = 1, col = rainbow(9), labels = 360 * 0:8/9)\npie(rep(1,9), radius = 1, col = rainbow_hcl(9), labels = 360 * 0:8/9)\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Fig 12-8-1.png){width=2100}\n:::\n:::\n\n\n\n\n### Figure 12.9: Diverging color palettes for HSV and HCL space\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(1,1), mar = c(1,1,1,1), oma = c(0,0,0,0))\nplot.new()\nrect(0:4/5, 0.2, 1:5/5, 0.5, border = 0, col = diverge_hcl(5))\nrect(0, 0.2, 1, 0.5, border = 1, col = NULL)\nrect(0:4/5, 0.55, 1:5/5, 0.85, border = 0, col = diverge_hsv(5))\nrect(0, 0.55, 1, 0.85, border = 1, col = NULL)\ntext(c(1:5/5 - 0.1), 0.11, c(\"(260, 100, 50)\", \"(260, 50, 70)\", \"(H, 0, 90)\", \"(0, 50, 70)\", \"(0, 100, 50)\"))\ntext(c(1:5/5 - 0.1), 0.91, c(\"(240, 100, 100)\", \"(240, 50, 100)\", \"(H, 0, 100)\", \"(0, 50, 100)\",\"(0, 100, 100)\"))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Fig 12-9-1.png){width=2100}\n:::\n:::\n\n\n\n### Figure 12.10: Spine plot with highlighting for the hospital data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmycol <- rep(grey.colors(2)[2:1], 1:2)\nmosaic(t(Hospital),\n       mar = c(left = 3.5),\n       labeling_args = list(offset_labels = c(left = 0.5),\n         offset_varnames = c(left = 1, top = 0.5), set_labels =\n         list(\"Visit frequency\" = c(\"Regular\",\"Less than\\nmonthly\",\"Never\"))),\n       split = TRUE, highlighting = 2, gp = gpar(fill = mycol, col = mycol))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Hospital Spine plot-1.png){width=2100}\n:::\n:::\n\n\n\n### Figure 12.11: Mosaic display of the hospital data with Friendly-like\n\n::: {.cell}\n\n```{.r .cell-code}\n### color coding of the residuals\n\nmosaic(t(Hospital), split = TRUE, shade = TRUE,\n       mar = c(left = 3.5),\n       gp_args = list(p.value = hos_chisq$p.value),\n       labeling_args = list(offset_labels = c(left = 0.5),\n         offset_varnames = c(left = 1, top = 0.5), set_labels =\n         list(\"Visit frequency\" = c(\"Regular\",\"Less than\\nmonthly\",\"Never\"))))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Hospital-mosaic-Friendly-1.png){width=2100}\n:::\n:::\n\n\n\n### Figure 12.12: Association plot of the hospital data with \n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Friendly-like color coding of the residuals\n##########################################################################\nassoc(t(Hospital), split = TRUE, shade = TRUE, keep = TRUE,\n      gp_args = list(p.value = hos_chisq$p.value))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Hospital-association-Friendly-1.png){width=2100}\n:::\n:::\n\n\n\n\n### Figure 12.13: Mosaic plot for the arthritis data, using the chi-squared test and fixed cut-off points for the shading\n\n::: {.cell}\n\n```{.r .cell-code}\n###########################################################################\nmosaic(art, shade = TRUE, gp_args = list(p.value = art_chisq$p.value))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Arthritis-Mosaic-chi-squared-1-1.png){width=2100}\n:::\n:::\n\n\n\n### Figure 12.14: Mosaic plot for the arthritis data, using the maximum test and data-driven cut-off points for the residuals\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(myseed)\nmosaic(art, gp = shading_max, gp_args = list(n = 5000))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/Arthritis-Mosaic-chi-squared-2-1.png){width=2100}\n:::\n:::\n\n\n\n### Figure 12.15: Pairs-plot for the UCB admissions data\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairs(UCBAdmissions)\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/USB Pairs Plot-1.png){width=2100}\n:::\n:::\n\n\n### Figure 12.16: Doubledecker plot for the UCB admissions data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndoubledecker(aperm(aperm(UCBAdmissions, c(1,3,2))[2:1,,], c(2,3,1)),\n             margins = c(left = 0, right = 5), col = rev(grey.colors(2)))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/unnamed-chunk-20-1.png){width=2100}\n:::\n:::\n\n\n\n\n\n### Figure 12.17: Mosic plot for the UCB admissions data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmosaic(aperm(UCBAdmissions, c(3,2,1)), data = UCBAdmissions, split = TRUE,\n       shade = TRUE, keep = FALSE, residuals = ucb_max$residuals,\n       gp_args = list(p.value = ucb_max$p.value), rep = c(Admission = FALSE))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/unnamed-chunk-21-1.png){width=2100}\n:::\n:::\n\n\n\n\n### Figure 12.18: Association plot for the UCB admissions data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nassoc(aperm(UCBAdmissions, c(3,2,1)), split = c(TRUE,FALSE,TRUE), shade = TRUE,\n      residuals_type = \"Pearson\", residuals = ucb_max$residuals,\n      gp_args = list(p.value = ucb_max$p.value), rep = c(Admission = FALSE))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/unnamed-chunk-22-1.png){width=2100}\n:::\n:::\n\n\n\n### Figure 12.19: Conditional association plot for the UCB admissions data\n\n::: {.cell}\n\n```{.r .cell-code}\ncotabplot(aperm(UCBAdmissions, c(2,1,3)), panel = cotab_coindep, shade = TRUE,\n          legend = FALSE,\n          panel_args = list(type = \"assoc\", margins = c(2,1,1,2), varnames = FALSE))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/unnamed-chunk-23-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n### Figure 12.20: Mosic plot with highlighting for the punishment data\n```\n:::\n::: {.cell}\n\n```{.r .cell-code}\nmosaic(~ age + education + memory + attitude, data = punish, keep = FALSE,\n       gp = gpar(fill = grey.colors(2)), spacing = spacing_highlighting,\n       rep = c(attitude = FALSE))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/unnamed-chunk-24-1.png){width=2100}\n:::\n:::\n\n\n\n### Figure 12.21: Conditional mosaic plot for the punishment data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ncotabplot(punish, panel = cotab_coindep, panel_args = list(varnames = FALSE, margins = c(2, 1, 1, 2)))\n```\n\n::: {.cell-output-display}\n![](mosaic-tutorial_files/figure-html/unnamed-chunk-25-1.png){width=2100}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}