{
  "hash": "f0a68c8866262f9f639fc7c886ddb025",
  "result": {
    "markdown": "---\ntitle: \"Bootstrap  Case Studies\"\nauthor: \"Arvind Venkatadri\"\ndate: \"26/Nov/2022\"\nabstract: \"Using Bootstrap Samples to make Decisions\"\ncode-fold: true\ncode-summary: \"Show the Code\"\ncode-copy: true\ncode-tools: true\ncode-line-numbers: true\ndf-print: paged\nexecute: \n  freeze: auto\n---\n\n\n\n\n### Example 5.2\n\n\n::: {.cell hash='bootstrap_cache/html/unnamed-chunk-1_db3e719dd1d760650e90c2933aa8632a'}\n\n```{.r .cell-code}\nmy.sample <- rgamma(16, 1, 1/2)\n\nN <- 10^5\nmy.boot <- numeric(N)\nfor (i in 1:N)\n {\n  x <- sample(my.sample, 16, replace = TRUE)  #draw resample\n  my.boot[i] <- mean(x)                     #compute mean, store in my.boot\n  }\n\nggplot() + geom_histogram(aes(my.boot), bins=15)\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-1-1.png){width=4200}\n:::\n\n```{.r .cell-code}\nmean(my.boot)  #mean\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.679718\n```\n:::\n\n```{.r .cell-code}\nsd(my.boot)    #bootstrap SE\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.7833044\n```\n:::\n:::\n\n\n### Example 5.3\n\nArsenic in wells in Bangladesh\n\n\n::: {.cell hash='bootstrap_cache/html/unnamed-chunk-2_14181654a9cd9d364add23c260fbaa4e'}\n\n```{.r .cell-code}\nBangladesh <- read.csv(\"../../../../../../materials/data/resampling/Bangladesh.csv\")\n\nggplot(Bangladesh, aes(Arsenic)) + geom_histogram(bins = 15)\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-2-1.png){width=4200}\n:::\n\n```{.r .cell-code}\nggplot(Bangladesh, aes(sample = Arsenic)) + stat_qq() + stat_qq_line()\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-2-2.png){width=4200}\n:::\n\n```{.r .cell-code}\nArsenic <- pull(Bangladesh, Arsenic)\n#Alternatively\n#Arsenic <- Bangladesh$Arsenic\n\nn <- length(Arsenic)\nN <- 10^4\n\narsenic.mean <- numeric(N)\n\nfor (i in 1:N)\n{\n   x <- sample(Arsenic, n, replace = TRUE)\n   arsenic.mean[i] <- mean(x)\n}\n\nggplot() + geom_histogram(aes(arsenic.mean), bins = 15) + \n  labs(title=\"Bootstrap distribution of means\") + \n  geom_vline(xintercept = mean(Arsenic), colour = \"blue\")\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-2-3.png){width=4200}\n:::\n\n```{.r .cell-code}\ndf <- data.frame(x = arsenic.mean)\nggplot(df, aes(sample = x)) + stat_qq() + stat_qq_line()\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-2-4.png){width=4200}\n:::\n\n```{.r .cell-code}\nmean(arsenic.mean)                 #bootstrap mean\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 125.4128\n```\n:::\n\n```{.r .cell-code}\nmean(arsenic.mean) - mean(Arsenic) #bias\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.09286144\n```\n:::\n\n```{.r .cell-code}\nsd(arsenic.mean)                   #bootstrap SE\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 18.20276\n```\n:::\n\n```{.r .cell-code}\nsum(arsenic.mean > 161.3224)/N\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.0333\n```\n:::\n\n```{.r .cell-code}\nsum(arsenic.mean < 89.75262)/N\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.016\n```\n:::\n:::\n\n\n### Example 5.4 Skateboard\n\n\n::: {.cell hash='bootstrap_cache/html/unnamed-chunk-3_6758b9a2bf589406203cf069aa0d9233'}\n\n```{.r .cell-code}\nSkateboard <- read.csv(\"../../../../../../materials/data/resampling/Skateboard.csv\")\n\ntestF <- Skateboard %>% filter(Experimenter == \"Female\") %>% pull(Testosterone)\ntestM <- Skateboard %>% filter(Experimenter == \"Male\") %>% pull(Testosterone)\n\nobserved <- mean(testF) - mean(testM)\n\nnf <- length(testF)\nnm <- length(testM)\n\nN <- 10^4\n\nTestMean <- numeric(N)\n\nfor (i in 1:N)\n{\n  sampleF <- sample(testF, nf, replace = TRUE)\n  sampleM <- sample(testM, nm, replace = TRUE)\n  TestMean[i] <- mean(sampleF) - mean(sampleM)\n}\n\ndf <- data.frame(TestMean)\nggplot(df) + geom_histogram(aes(TestMean), bins = 15) + \n  labs(title = \"Bootstrap distribution of difference in means\", xlab = \"means\") +\n  geom_vline(xintercept = observed, colour = \"blue\")\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-3-1.png){width=4200}\n:::\n\n```{.r .cell-code}\nggplot(df, aes(sample = TestMean))  + stat_qq() + stat_qq_line()\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-3-2.png){width=4200}\n:::\n\n```{.r .cell-code}\nmean(testF) - mean(testM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 83.0692\n```\n:::\n\n```{.r .cell-code}\nmean(TestMean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 83.12008\n```\n:::\n\n```{.r .cell-code}\nsd(TestMean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 29.13951\n```\n:::\n\n```{.r .cell-code}\nquantile(TestMean,c(0.025,0.975))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     2.5%     97.5% \n 25.12621 139.64168 \n```\n:::\n\n```{.r .cell-code}\nmean(TestMean)- observed  #bias\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.05088193\n```\n:::\n:::\n\n\n### Permutation test for Skateboard means\n\n\n::: {.cell hash='bootstrap_cache/html/unnamed-chunk-4_cd689c98280c96da9deded96f70837a9'}\n\n```{.r .cell-code}\ntestAll <- pull(Skateboard, Testosterone)\n#testAll <- Skateboard$Testosterone\n\nN <- 10^4 - 1  #set number of times to repeat this process\n\n#set.seed(99)\nresult <- numeric(N) # space to save the random differences\nfor(i in 1:N)\n  {\n  index <- sample(71, size = nf, replace = FALSE) #sample of numbers from 1:71\n  result[i] <- mean(testAll[index]) - mean(testAll[-index])\n}\n\n(sum(result >= observed)+1)/(N + 1)  #P-value\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.0062\n```\n:::\n\n```{.r .cell-code}\nggplot() + geom_histogram(aes(result), bins = 15) + \n  labs(x = \"xbar1-xbar2\", title=\"Permutation distribution for testosterone levels\") +\n  geom_vline(xintercept = observed, colour = \"blue\")\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-4-1.png){width=4200}\n:::\n\n```{.r .cell-code}\ndf <- data.frame(result)\nggplot(df, aes(sample = result)) + stat_qq() + stat_qq_line()\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-4-2.png){width=4200}\n:::\n:::\n\n\n### Section 5.4.1 Matched pairs for Diving data\n\n\n::: {.cell hash='bootstrap_cache/html/unnamed-chunk-5_c1dfab40f6a1e4bb789d83239f2d7dca'}\n\n```{.r .cell-code}\nDiving2017 <- read.csv(\"../../../../../../materials/data/resampling/Diving2017.csv\")\nDiff <- Diving2017 %>% mutate(Diff = Final - Semifinal) %>% pull(Diff)\n#alternatively\n#Diff <- Diving2017$Final - Diving2017$Semifinal\nn <- length(Diff)\n\nN <- 10^5\nresult <- numeric(N)\n\nfor (i in 1:N)\n{\n  dive.sample <- sample(Diff, n, replace = TRUE)\n  result[i] <- mean(dive.sample)\n}\n\nggplot() + geom_histogram(aes(result), bins = 15)\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-5-1.png){width=4200}\n:::\n\n```{.r .cell-code}\nquantile(result, c(0.025, 0.975))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     2.5%     97.5% \n-6.495937 31.016771 \n```\n:::\n:::\n\n\n### Example 5.5 Verizon cont. Bootstrap means for the ILEC data and for the CLEC data\n\nBootstrap difference of means.\n\n\n::: {.cell hash='bootstrap_cache/html/unnamed-chunk-6_320caa978e00a884054c6c02232a2b5b'}\n\n```{.r .cell-code}\nVerizon <- read.csv(\"../../../../../../materials/data/resampling/Verizon.csv\")\n\nTime.ILEC <- Verizon %>% filter(Group == \"ILEC\") %>% pull(Time)\nTime.CLEC <- Verizon %>% filter(Group == \"CLEC\") %>% pull(Time)\n\nobserved <- mean(Time.ILEC) - mean(Time.CLEC)\n\nn.ILEC <- length(Time.ILEC)\nn.CLEC <- length(Time.CLEC)\n\nN <- 10^4\n\ntime.ILEC.boot <- numeric(N)\ntime.CLEC.boot <- numeric(N)\ntime.diff.mean <- numeric(N)\n\nset.seed(100)\nfor (i in 1:N)\n {\n  ILEC.sample <- sample(Time.ILEC, n.ILEC, replace = TRUE)\n  CLEC.sample <- sample(Time.CLEC, n.CLEC, replace = TRUE)\n  time.ILEC.boot[i] <- mean(ILEC.sample)\n  time.CLEC.boot[i] <- mean(CLEC.sample)\n  time.diff.mean[i] <- mean(ILEC.sample) - mean(CLEC.sample)\n}\n\n#bootstrap for ILEC\nggplot() + geom_histogram(aes(time.ILEC.boot), bins = 15) + \n  labs(title = \"Bootstrap distribution of ILEC means\", x = \"means\") + \n  geom_vline(xintercept = mean(Time.ILEC), colour = \"blue\") + \n  geom_vline(xintercept = mean(time.ILEC.boot), colour = \"red\", lty=2)\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-6-1.png){width=4200}\n:::\n\n```{.r .cell-code}\nsummary(time.ILEC.boot)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  7.036   8.156   8.400   8.406   8.642   9.832 \n```\n:::\n\n```{.r .cell-code}\ndf <- data.frame(x = time.ILEC.boot)\nggplot(df, aes(sample = x)) + stat_qq() + stat_qq_line()\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-6-2.png){width=4200}\n:::\n\n```{.r .cell-code}\n#bootstrap for CLEC\nggplot() + geom_histogram(aes(time.CLEC.boot), bins = 15) + \n  labs(title = \"Bootstrap distribution of CLEC means\", x = \"means\") + \n  geom_vline(xintercept = mean(Time.CLEC), colour = \"blue\") + \n  geom_vline(xintercept = mean(time.CLEC.boot), colour = \"red\", lty = 2)\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-6-3.png){width=4200}\n:::\n\n```{.r .cell-code}\ndf <- data.frame(x = time.CLEC.boot)\nggplot(df, aes(sample = x)) + stat_qq() + stat_qq_line()\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-6-4.png){width=4200}\n:::\n\n```{.r .cell-code}\n#Different in means\nggplot() + geom_histogram(aes(time.diff.mean), bins = 15) + \n  labs(title = \"Bootstrap distribution of difference in means\", x = \"means\") +\n  geom_vline(xintercept = mean(time.diff.mean), colour = \"blue\") + \n  geom_vline(xintercept = mean(observed), colour = \"red\", lty = 2)\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-6-5.png){width=4200}\n:::\n\n```{.r .cell-code}\ndf <- data.frame(x = time.diff.mean)\nggplot(df, aes(sample = x)) + stat_qq() + stat_qq_line()\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-6-6.png){width=4200}\n:::\n\n```{.r .cell-code}\nmean(time.diff.mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -8.096489\n```\n:::\n\n```{.r .cell-code}\nquantile(time.diff.mean, c(0.025, 0.975))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      2.5%      97.5% \n-16.970068  -1.690859 \n```\n:::\n:::\n\n\n### Section 5.5 Verizon cont.\n\nBootstrap difference in trimmed means\n\n\n::: {.cell hash='bootstrap_cache/html/unnamed-chunk-7_906a8d46d0c2a46d8eca254785293434'}\n\n```{.r .cell-code}\nTime.ILEC <- Verizon %>% filter(Group == \"ILEC\") %>% pull(Time)\nTime.CLEC <- Verizon %>% filter(Group == \"CLEC\") %>% pull(Time)\nn.ILEC <- length(Time.ILEC)\nn.CLEC <- length(Time.CLEC)\n\nN <- 10^4\ntime.diff.trim <- numeric(N)\n\n#set.seed(100)\nfor (i in 1:N)\n{\n  x.ILEC <- sample(Time.ILEC, n.ILEC, replace = TRUE)\n  x.CLEC <- sample(Time.CLEC, n.CLEC, replace = TRUE)\n  time.diff.trim[i] <- mean(x.ILEC, trim = .25) - mean(x.CLEC, trim = .25)\n}\n\nggplot() + geom_histogram(aes(time.diff.trim), bins = 15) + \n  labs(x = \"difference in trimmed means\") + \n  geom_vline(xintercept = mean(time.diff.trim),colour = \"blue\") + \n  geom_vline(xintercept = mean(Time.ILEC, trim = .25) - mean(Time.CLEC, trim = .25), colour = \"red\", lty = 2)\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-7-1.png){width=4200}\n:::\n\n```{.r .cell-code}\ndf <- data.frame(x = time.diff.trim)\nggplot(df, aes(sample = x)) + stat_qq() + stat_qq_line()\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-7-2.png){width=4200}\n:::\n\n```{.r .cell-code}\nmean(time.diff.trim)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -10.32079\n```\n:::\n\n```{.r .cell-code}\nquantile(time.diff.trim, c(0.025,0.975))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     2.5%     97.5% \n-15.47049  -4.97130 \n```\n:::\n:::\n\n\n### Section 5.5 Other statistics Verizon cont:\n\nBootstrap of the ratio of means\n\n<tt>`Time.ILEC`</tt> and <tt>`Time.CLEC`</tt> created above.\n\n<tt>`n.ILEC`</tt>, <tt>`n.CLEC`</tt> created above\n\n\n::: {.cell hash='bootstrap_cache/html/unnamed-chunk-8_47e60d959660005defed1f14dc5a6ecb'}\n\n```{.r .cell-code}\nN <- 10^4\ntime.ratio.mean <- numeric(N)\n\n#set.seed(100)\nfor (i in 1:N)\n{\n  ILEC.sample <- sample(Time.ILEC, n.ILEC, replace = TRUE)\n  CLEC.sample <- sample(Time.CLEC, n.CLEC, replace = TRUE)\n  time.ratio.mean[i] <- mean(ILEC.sample)/mean(CLEC.sample)\n}\n\nggplot() + geom_histogram(aes(time.ratio.mean), bins = 12) + \n  labs(title = \"bootstrap distribution of ratio of means\", x = \"ratio of means\") +\n  geom_vline(xintercept = mean(time.ratio.mean), colour = \"red\", lty = 2) + \n  geom_vline(xintercept  = mean(Time.ILEC)/mean(Time.CLEC), col = \"blue\")\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-8-1.png){width=4200}\n:::\n\n```{.r .cell-code}\ndf <- data.frame(x = time.ratio.mean)\nggplot(df, aes(sample = x)) + stat_qq() + stat_qq_line()\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-8-2.png){width=4200}\n:::\n\n```{.r .cell-code}\nmean(time.ratio.mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.5429164\n```\n:::\n\n```{.r .cell-code}\nsd(time.ratio.mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.1354238\n```\n:::\n\n```{.r .cell-code}\nquantile(time.ratio.mean, c(0.025, 0.975))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     2.5%     97.5% \n0.3283862 0.8517156 \n```\n:::\n:::\n\n\n### Example 5.7 Relative risk example\n\n\n::: {.cell hash='bootstrap_cache/html/unnamed-chunk-9_d4dc8b7f084a0b8b0b1f1d16e55b3394'}\n\n```{.r .cell-code}\nhighbp <- rep(c(1,0),c(55,3283))   #high blood pressure\nlowbp <- rep(c(1,0),c(21,2655))    #low blood pressure\n\nN <- 10^4\nboot.rr <- numeric(N)\nhigh.prop <- numeric(N)\nlow.prop <- numeric(N)\n\nfor (i in 1:N)\n{\n   x.high <- sample(highbp,3338, replace = TRUE)\n   x.low  <- sample(lowbp, 2676, replace = TRUE)\n   high.prop[i] <- sum(x.high)/3338\n   low.prop[i]  <- sum(x.low)/2676\n   boot.rr[i] <- high.prop[i]/low.prop[i]\n}\n\nci <- quantile(boot.rr, c(0.025, 0.975))\n\nggplot() + geom_histogram(aes(boot.rr), bins = 15) + \n  labs(title = \"Bootstrap distribution of relative risk\", x = \"relative risk\") +\n  geom_vline(aes(xintercept = mean(boot.rr), colour = \"mean of bootstrap\")) +\n  geom_vline(aes(xintercept = 2.12, colour=\"observed rr\"), lty = 2) + \n  scale_colour_manual(name=\"\", values = c(\"mean of bootstrap\"=\"blue\", \"observed rr\" = \"red\"))\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-9-1.png){width=4200}\n:::\n\n```{.r .cell-code}\ntemp <- ifelse(high.prop < 1.31775*low.prop, 1, 0)\ntemp2 <- ifelse(high.prop > 3.687*low.prop, 1, 0)\ntemp3 <- temp + temp2\n\ndf <- data.frame(y=high.prop, x=low.prop, temp, temp2, temp3)\ndf1 <- df %>% filter(temp == 1)\ndf2 <- df %>% filter (temp2 == 1)\ndf3 <- df %>% filter(temp3 == 0)\n\nggplot(df, aes(x=x, y = y)) + \n  geom_point(data =df1, aes(x= x, y = y), colour = \"green\") + \n  geom_point(data = df2, aes(x = x, y = y), colour = \"green\") + \n  geom_point(data = df3, aes(x = x, y = y), colour = \"red\") + \n  geom_vline(aes(xintercept = mean(low.prop)), colour = \"red\") +\n  geom_hline(yintercept = mean(high.prop), colour = \"red\") + \n  geom_abline(aes(intercept = 0, slope = 2.12, colour = \"observed rr\"), lty = 2, lwd = 1) + \n  geom_abline(aes(intercept = 0, slope = ci[1], colour = \"bootstrap CI\"), lty = 2, lwd = 1) + \n  geom_abline(intercept = 0, slope = ci[2], colour = \"blue\", lty = 2, lwd = 1) +\n  scale_colour_manual(name=\"\", values=c(\"observed rr\"=\"black\", \"bootstrap CI\" = \"blue\")) +\n  labs(x = \"Proportion in low blood pressure group\", y = \"Proportion in high blood pressure group\")\n```\n\n::: {.cell-output-display}\n![](bootstrap_files/figure-html/unnamed-chunk-9-2.png){width=4200}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}